from flask import Blueprint, request, jsonify
from backend_app.models.malware_scan import MalwareScan  # ✅ FIXED
from backend_app.services.malware_scanner import scan_file  # ✅ FIXED


malware_scan_routes = Blueprint('malware_scan_routes', __name__)

# Upload & Scan File
@malware_scan_routes.route('/scan', methods=['POST'])
def scan_file_route():
    file = request.files['file']
    user_id = request.form['user_id']

    scan_status = scan_file(file)
    MalwareScan.save_scan_result(user_id, file.filename, file.content_type, scan_status)

    return jsonify({"message": "File scanned", "status": scan_status})
